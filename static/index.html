<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: rgb(247, 248, 254);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            min-height: 100vh;
            overflow-y: auto;
        }

        .navbar {
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 0;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand h1 {
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .nav-links {
            display: flex;
            gap: 24px;
        }

        .nav-link {
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            color: #1e40af;
            background: #f1f5f9;
        }

        .nav-link.active {
            color: #1e40af;
            background: #eff6ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #ffffff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            text-align: center;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .stat-card h3 {
            color: #64748b;
            font-size: 0.875rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e40af;
            margin: 0;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 30px;
            min-height: 400px;
        }

        .panel {
            background: #ffffff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .panel#requests-panel {
            max-height: 700px;
            overflow: hidden;
        }

        .panel#executors-panel {
            min-height: 200px;
            max-height: none;
            overflow: visible;
        }

        #requests-list {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #requests-list::-webkit-scrollbar {
            width: 4px;
        }

        #requests-list::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 2px;
        }

        #requests-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        #requests-list::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        #executors-list {
            max-height: none;
            overflow: visible;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .panel h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.25rem;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }


        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            box-shadow: 0 2px 4px rgba(107, 114, 128, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(107, 114, 128, 0.4);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }


        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }

        .chart-section {
            background: #ffffff;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .chart-section:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .chart-section h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            text-align: center;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 6px;
        }

        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 20px;
            gap: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin: 0;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .progress-chart {
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin: 0;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .progress-chart::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .workload-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 20px;
            gap: 6px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin: 0;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .workload-chart::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
        }

        .performance-analysis-chart {
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            margin: 0;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }

        .performance-analysis-chart::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
        }

        .chart-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-bar:hover {
            transform: translateY(-3px);
        }

        .chart-bar-column {
            width: 100%;
            background: #1e40af;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
            position: relative;
            min-height: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-bar:hover .chart-bar-column {
            background: #1d4ed8;
            box-shadow: 0 6px 20px rgba(30, 64, 175, 0.4);
            transform: scale(1.05);
        }

        .chart-bar-label {
            margin-top: 8px;
            font-size: 0.85em;
            color: #4a5568;
            font-weight: 600;
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chart-bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 700;
            color: #2d3748;
            background: rgba(255, 255, 255, 0.9);
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.7em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .executor-item, .request-item {
            padding: 12px;
            margin-bottom: 0;
            border-radius: 8px;
            border-left: 4px solid #1e40af;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            min-height: 80px;
        }
        
        .request-item {
            padding: 10px;
            margin-bottom: 6px;
            font-size: 0.9em;
        }

        .executor-item:hover, .request-item:hover {
            background: #f8fafc;
            border-left-color: #1d4ed8;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .request-item.pending {
            border-left-color: #d97706;
            background: #fffbeb;
        }

        .request-item.assigned {
            border-left-color: #0891b2;
            background: #f0f9ff;
        }

        .request-item.completed {
            border-left-color: #059669;
            background: #f0fdf4;
        }

        .request-item.new {
            animation: pulse 1s;
        }

        @keyframes pulse {
            0% { 
                background: #fef3c7;
                transform: scale(1.02);
            }
            100% { 
                background: #ffffff;
                transform: scale(1);
            }
        }

        .flow-box {
            width: 100px;
            height: 100px;
            margin: 10px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            position: relative;
        }

        .flow-box:hover {
            transform: scale(1.1);
        }

        .flow-box.pending {
            background: #2196F3;
            border: 3px solid #1976D2;
        }

        .flow-box.executor {
            background: #333;
            border: 3px solid #111;
            color: white;
        }

        .flow-box.assigned {
            background: #4CAF50;
            border: 3px solid #388E3C;
        }

        .flow-request {
            width: 60px;
            height: 30px;
            background: #2196F3;
            margin: 2px;
            border-radius: 5px;
            font-size: 10px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            margin: 4px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #1e40af;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }

        .btn-warning {
            background: #d97706;
            color: white;
        }

        .btn-warning:hover {
            background: #b45309;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3);
        }

        .btn-danger {
            background: #dc2626;
            color: white;
            border: 1px solid #dc2626;
        }

        .btn-danger:hover {
            background: #b91c1c;
            border-color: #991b1b;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s;
        }

        .error-percent {
            color: #dc3545;
            font-weight: bold;
        }

        .good-percent {
            color: #28a745;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #ffffff;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            position: relative;
            border: 1px solid #e2e8f0;
        }
        
        .modal-close {
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 24px;
            font-weight: bold;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
        }
        
        .modal-close:hover {
            color: #dc2626;
            background: #fef2f2;
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            background: #ffffff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }
        
        .modal-content input:focus, .modal-content select:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        
        .modal-content label {
            display: block;
            margin-bottom: 6px;
            color: #374151;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .modal-content .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .modal-content .btn-group button {
            flex: 1;
        }

        .modal-body {
            margin: 20px 0;
        }

        .modal-body p {
            margin: 10px 0;
            line-height: 1.5;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è */
        #delete-modal .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .warning-block {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 10px;
            text-align: center;
            background: #fef2f2;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #dc3545;
        }

        /* –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle {
            position: relative;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .dropdown-toggle::after {
            content: '';
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid currentColor;
            transition: transform 0.2s ease;
        }

        .dropdown-toggle:hover::after {
            transform: translateY(1px);
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 150px;
            margin-top: 4px;
        }

        .dropdown-menu a {
            display: block;
            padding: 10px 16px;
            color: #374151;
            text-decoration: none;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
        }

        .dropdown-menu a:last-child {
            border-bottom: none;
        }

        .dropdown-menu a:hover {
            background-color: #f8fafc;
            color: #1e40af;
        }

        .dropdown-menu.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease-out;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .request-item.moving {
            animation: approvalProcess 0.1s ease-in-out forwards;
            position: relative;
            overflow: hidden;
        }

        @keyframes approvalProcess {
            0% {
                opacity: 1;
                transform: scale(1);
                background: linear-gradient(135deg, #e3f2fd, #bbdefb);
                border-left: 4px solid #2196f3;
            }
            15% {
                opacity: 0.95;
                transform: scale(1.02);
                background: linear-gradient(135deg, #fff3e0, #ffcc80);
                border-left: 4px solid #ff9800;
                box-shadow: 0 4px 15px rgba(255, 152, 0, 0.2);
            }
            30% {
                opacity: 0.9;
                transform: scale(1.05);
                background: linear-gradient(135deg, #f3e5f5, #ce93d8);
                border-left: 4px solid #9c27b0;
                box-shadow: 0 6px 20px rgba(156, 39, 176, 0.2);
            }
            45% {
                opacity: 0.85;
                transform: scale(1.08);
                background: linear-gradient(135deg, #e0f2f1, #80cbc4);
                border-left: 4px solid #009688;
                box-shadow: 0 8px 25px rgba(0, 150, 136, 0.2);
            }
            60% {
                opacity: 0.9;
                transform: scale(1.05);
                background: linear-gradient(135deg, #e8f5e8, #a5d6a7);
                border-left: 4px solid #4caf50;
                box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
            }
            80% {
                opacity: 0.95;
                transform: scale(1.02);
                background: linear-gradient(135deg, #e8f5e8, #4caf50);
                border-left: 4px solid #2e7d32;
                box-shadow: 0 4px 15px rgba(46, 125, 50, 0.4);
            }
            100% {
                opacity: 0;
                transform: scale(0.8);
                background: linear-gradient(135deg, #e8f5e8, #2e7d32);
                border-left: 4px solid #1b5e20;
                box-shadow: 0 2px 10px rgba(27, 94, 32, 0.5);
                height: 0;
                margin: 0;
                padding: 0;
            }
        }

        .request-item.moving::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 0.05s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ */
        .controls {
            background: #ffffff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }

        .controls h3 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 16px 0;
        }

        .checkbox-container input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #1e40af;
        }

        .checkbox-container label {
            font-weight: 500;
            color: #374151;
            cursor: pointer;
            font-size: 0.875rem;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .navbar {
                flex-direction: column;
                gap: 16px;
                padding: 16px 0;
            }
            
            .nav-links {
                gap: 16px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .panel#executors-panel {
                min-height: 150px;
            }
            
            .executor-item {
                min-height: 70px;
                padding: 10px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            
            .nav-brand h1 {
                font-size: 1.25rem;
            }
            
            .panel {
                padding: 20px;
            }
            
            .controls {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫</h1>
            </div>
            <div class="nav-links">
                <a href="#main" class="nav-link active" onclick="scrollToSection('main')">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="#stats" class="nav-link" onclick="scrollToSection('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="#executors" class="nav-link" onclick="scrollToSection('executors')">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</a>
                <a href="#requests" class="nav-link" onclick="scrollToSection('requests')">–ó–∞—è–≤–∫–∏</a>
            </div>
        </nav>

        <div id="main" class="stats-grid">
            <div class="stat-card">
                <h3>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</h3>
                <div class="value" id="total-requests">0</div>
            </div>
            <div class="stat-card">
                <h3>–û–∂–∏–¥–∞—é—â–∏—Ö</h3>
                <div class="value" id="pending-requests">0</div>
            </div>
            <div class="stat-card">
                <h3>–ù–∞–∑–Ω–∞—á–µ–Ω–æ</h3>
                <div class="value" id="assigned-requests">0</div>
            </div>
            <div class="stat-card">
                <h3>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</h3>
                <div class="value" id="completed-requests">0</div>
            </div>
            <div class="stat-card">
                <h3>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</h3>
                <div class="value" id="active-executors">0</div>
            </div>
            <div class="stat-card">
                <h3>–ü–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å</h3>
                <div class="value good-percent" id="error-percent">0%</div>
            </div>
        </div>

        <div id="stats" class="panel" style="margin-bottom: 20px;">
            <h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="charts-grid">
                <div class="chart-section">
                    <h3>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏</h3>
                    <div id="chart-container" class="chart-container"></div>
                </div>
                <div class="chart-section">
                    <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                    <div id="progress-chart" class="chart-container"></div>
                </div>
                <div class="chart-section">
                    <h3>–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
                    <div id="performance-analysis-chart" class="chart-container"></div>
                </div>
            </div>
        </div>

        <div class="content-grid">
            <div id="executors" class="panel" id="executors-panel">
                <h2>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</h2>
                <div id="executors-list"></div>
            </div>
            <div id="requests" class="panel" id="requests-panel">
                <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏</h2>
                <div id="requests-list"></div>
            </div>
        </div>

        <div class="controls">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="showExecutorModal()" id="add-executor-btn">–î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</button>
                <div class="dropdown">
                    <button class="btn btn-success dropdown-toggle" onclick="toggleCreateDropdown()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫–∏</button>
                    <div class="dropdown-menu" id="create-dropdown">
                        <a href="#" onclick="createRandomRequests(); hideCreateDropdown();">5 –∑–∞—è–≤–æ–∫</a>
                        <a href="#" onclick="createMassiveRequests(); hideCreateDropdown();">1000 –∑–∞—è–≤–æ–∫</a>
                        <a href="#" onclick="createContinuousRequests(); hideCreateDropdown();">10000 –∑–∞—è–≤–æ–∫</a>
                    </div>
                </div>
                <button onclick="exportToExcel()" class="btn btn-primary">
                    üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </button>
                <button onclick="exportToHTML()" class="btn btn-secondary">
                    üìà HTML –æ—Ç—á–µ—Ç
                </button>
                <button class="btn btn-danger" onclick="clearAllRequests()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏</button>
            </div>
            <button class="btn btn-success" onclick="document.getElementById('fileInput').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Excel</button>
            <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleFileUpload(event)">
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let autoRefreshInterval = null;
        let lastRequestIds = new Set();
        
        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        let requestStats = {
            startTime: Date.now(),
            totalProcessed: 0,
            lastMinuteProcessed: 0,
            lastMinuteTime: Date.now(),
            requestsPerMinute: 0
        };

        // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel
        async function exportToExcel() {
            try {
                console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Excel...');
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                const [statsResponse, requestsResponse, executorsResponse] = await Promise.all([
                    fetch(`${API_BASE}/stats`),
                    fetch(`${API_BASE}/requests/recent/1000`),
                    fetch(`${API_BASE}/executors/`)
                ]);

                const stats = await statsResponse.json();
                const requests = await requestsResponse.json();
                const executors = await executorsResponse.json();

                // –°–æ–∑–¥–∞–µ–º Excel —Ñ–∞–π–ª
                const workbook = XLSX.utils.book_new();

                // 1. –õ–∏—Å—Ç —Å –∑–∞—è–≤–∫–∞–º–∏
                const requestsData = requests.map(req => ({
                    'ID –∑–∞—è–≤–∫–∏': req.id,
                    '–°—Ç–∞—Ç—É—Å': req.status,
                    '–ì–æ—Ä–æ–¥': req.parameters?.parameters?.city || '–ù–µ —É–∫–∞–∑–∞–Ω',
                    '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö': req.parameters?.parameters?.data_type || '–ù–µ —É–∫–∞–∑–∞–Ω',
                    '–ù–∞–∑–Ω–∞—á–µ–Ω –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é': req.assigned_to || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω',
                    '–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è': getExecutorName(req.assigned_to, executors),
                    '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': new Date(req.created_at).toLocaleString('ru-RU'),
                    '–î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è': req.assigned_at ? new Date(req.assigned_at).toLocaleString('ru-RU') : '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞',
                    '–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è': req.completed_at ? new Date(req.completed_at).toLocaleString('ru-RU') : '–ù–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞'
                }));

                const requestsSheet = XLSX.utils.json_to_sheet(requestsData);
                XLSX.utils.book_append_sheet(workbook, requestsSheet, '–ó–∞—è–≤–∫–∏');

                // 2. –õ–∏—Å—Ç —Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏
                const executorsData = executors.map(exec => ({
                    'ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è': exec.id,
                    '–ò–º—è': exec.name,
                    '–ì–æ—Ä–æ–¥': exec.parameters?.city || '–õ—é–±–æ–π',
                    '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö': exec.parameters?.data_type || '–õ—é–±–æ–π',
                    '–í—Å–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ': exec.total_assigned || 0,
                    '–í—ã–ø–æ–ª–Ω–µ–Ω–æ': exec.completed_count || 0,
                    '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ': exec.assigned_count || 0,
                    '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (%)': exec.completed_count > 0 ? 
                        Math.round((exec.completed_count / exec.total_assigned) * 100) : 0,
                    '–ê–∫—Ç–∏–≤–µ–Ω': exec.is_active ? '–î–∞' : '–ù–µ—Ç',
                    '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': new Date(exec.created_at).toLocaleString('ru-RU')
                }));

                const executorsSheet = XLSX.utils.json_to_sheet(executorsData);
                XLSX.utils.book_append_sheet(workbook, executorsSheet, '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏');

                // 3. –õ–∏—Å—Ç —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
                const statsData = [
                    ['–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å', '–ó–Ω–∞—á–µ–Ω–∏–µ'],
                    ['–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫', stats.total_requests],
                    ['–ó–∞—è–≤–æ–∫ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏', stats.pending_requests],
                    ['–ó–∞—è–≤–æ–∫ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ', stats.assigned_requests],
                    ['–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫', stats.completed_requests],
                    ['–í—Å–µ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π', stats.total_executors],
                    ['–ê–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π', stats.active_executors],
                    ['–ü–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (%)', stats.distribution_error_percent],
                    ['–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è', stats.avg_load_per_executor],
                    ['–í—Ä–µ–º—è —ç–∫—Å–ø–æ—Ä—Ç–∞', new Date().toLocaleString('ru-RU')]
                ];

                const statsSheet = XLSX.utils.aoa_to_sheet(statsData);
                XLSX.utils.book_append_sheet(workbook, statsSheet, '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞');

                // 4. –õ–∏—Å—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (–¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è)
                const chartsData = [
                    ['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞—è–≤–æ–∫', '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (%)'],
                    ...executors.map(exec => [
                        exec.name,
                        exec.completed_count || 0,
                        exec.assigned_count || 0,
                        exec.completed_count > 0 ? 
                            Math.round((exec.completed_count / exec.total_assigned) * 100) : 0
                    ])
                ];

                const chartsSheet = XLSX.utils.aoa_to_sheet(chartsData);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
                const range = XLSX.utils.decode_range(chartsSheet['!ref']);
                for (let R = range.s.r; R <= range.e.r; ++R) {
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const cellAddress = XLSX.utils.encode_cell({r: R, c: C});
                        if (!chartsSheet[cellAddress]) continue;
                        
                        // –ó–∞–≥–æ–ª–æ–≤–∫–∏
                        if (R === 0) {
                            chartsSheet[cellAddress].s = {
                                font: { bold: true, color: { rgb: "FFFFFF" } },
                                fill: { fgColor: { rgb: "366092" } },
                                alignment: { horizontal: "center" }
                            };
                        }
                        // –î–∞–Ω–Ω—ã–µ
                        else {
                            chartsSheet[cellAddress].s = {
                                alignment: { horizontal: "center" }
                            };
                        }
                    }
                }
                
                XLSX.utils.book_append_sheet(workbook, chartsSheet, '–î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤');

                // 5. –õ–∏—Å—Ç —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
                const statusData = [
                    ['–°—Ç–∞—Ç—É—Å', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', '–ü—Ä–æ—Ü–µ–Ω—Ç'],
                    ['–í –æ–∂–∏–¥–∞–Ω–∏–∏', stats.pending_requests, 
                        Math.round((stats.pending_requests / stats.total_requests) * 100)],
                    ['–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', stats.assigned_requests, 
                        Math.round((stats.assigned_requests / stats.total_requests) * 100)],
                    ['–ó–∞–≤–µ—Ä—à–µ–Ω–æ', stats.completed_requests, 
                        Math.round((stats.completed_requests / stats.total_requests) * 100)]
                ];

                const statusSheet = XLSX.utils.aoa_to_sheet(statusData);
                XLSX.utils.book_append_sheet(workbook, statusSheet, '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º');

                // 6. –õ–∏—Å—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const performanceData = [
                    ['–ú–µ—Ç—Ä–∏–∫–∞', '–ó–Ω–∞—á–µ–Ω–∏–µ', '–û–ø–∏—Å–∞–Ω–∏–µ'],
                    ['–û–±—â–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã (%)', 
                        Math.round((stats.completed_requests / stats.total_requests) * 100),
                        '–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞'],
                    ['–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è', 
                        Math.round(stats.avg_load_per_executor * 100) / 100,
                        '–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'],
                    ['–ü–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (%)', 
                        Math.round(stats.distribution_error_percent * 100) / 100,
                        '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è'],
                    ['–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π', 
                        Math.round((stats.active_executors / stats.total_executors) * 100),
                        '–ü—Ä–æ—Ü–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞'],
                    ['–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∑–∞—è–≤–æ–∫/–º–∏–Ω)', 
                        Math.round(requestStats.requestsPerMinute * 100) / 100,
                        '–¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫'],
                    ['–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã (–º–∏–Ω)', 
                        Math.round((Date.now() - requestStats.startTime) / 60000),
                        '–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã'],
                    ['–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏ (–º–∏–Ω)', 
                        requestStats.requestsPerMinute > 0 ? 
                            Math.round((Date.now() - requestStats.startTime) / requestStats.totalProcessed / 60000 * 100) / 100 : 0,
                        '–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞—è–≤–∫–∏']
                ];

                const performanceSheet = XLSX.utils.aoa_to_sheet(performanceData);
                XLSX.utils.book_append_sheet(workbook, performanceSheet, '–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏');

                // 7. –õ–∏—Å—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞)
                const timeData = [];
                const now = new Date();
                for (let i = 23; i >= 0; i--) {
                    const hour = new Date(now.getTime() - i * 60 * 60 * 1000);
                    const hourStr = hour.getHours().toString().padStart(2, '0') + ':00';
                    
                    // –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —á–∞—Å–∞–º (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—ã–ª–æ –±—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
                    const simulatedRequests = Math.floor(Math.random() * 50) + 10;
                    const simulatedCompleted = Math.floor(simulatedRequests * (0.7 + Math.random() * 0.3));
                    
                    timeData.push([
                        hourStr,
                        simulatedRequests,
                        simulatedCompleted,
                        Math.round((simulatedCompleted / simulatedRequests) * 100)
                    ]);
                }

                const timeSheetData = [
                    ['–í—Ä–µ–º—è', '–°–æ–∑–¥–∞–Ω–æ –∑–∞—è–≤–æ–∫', '–ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞—è–≤–æ–∫', '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (%)'],
                    ...timeData
                ];

                const timeSheet = XLSX.utils.aoa_to_sheet(timeSheetData);
                XLSX.utils.book_append_sheet(workbook, timeSheet, '–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞');

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
                const fileName = `requests_export_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.xlsx`;
                XLSX.writeFile(workbook, fileName);

                console.log('‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                console.log(`üìÅ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ${fileName}`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification('–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
        function getExecutorName(executorId, executors) {
            if (!executorId) return '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω';
            const executor = executors.find(exec => exec.id === executorId);
            return executor ? executor.name : `–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å #${executorId}`;
        }

        // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ HTML —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
        async function exportToHTML() {
            try {
                console.log('üîÑ –°–æ–∑–¥–∞–µ–º HTML –æ—Ç—á–µ—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏...');
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                const [statsResponse, requestsResponse, executorsResponse] = await Promise.all([
                    fetch(`${API_BASE}/stats`),
                    fetch(`${API_BASE}/requests/recent/1000`),
                    fetch(`${API_BASE}/executors/`)
                ]);

                const stats = await statsResponse.json();
                const requests = await requestsResponse.json();
                const executors = await executorsResponse.json();

                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π HTML –æ—Ç—á–µ—Ç
                const htmlContent = createSimpleHTMLReport(stats, requests, executors);

                // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `report_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.html`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                console.log('‚úÖ HTML –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
                showNotification('HTML –æ—Ç—á–µ—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ —Å–æ–∑–¥–∞–Ω!', 'success');

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ HTML –æ—Ç—á–µ—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ HTML –æ—Ç—á–µ—Ç–∞', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ HTML –æ—Ç—á–µ—Ç–∞
        function createSimpleHTMLReport(stats, requests, executors) {
            const currentDate = new Date().toLocaleString('ru-RU');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞—è–≤–æ–∫
            let requestsTable = '';
            requests.slice(0, 50).forEach(req => {
                const statusText = req.status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' : 
                                 req.status === 'assigned' ? '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' : '–í –æ–∂–∏–¥–∞–Ω–∏–∏';
                const executorName = getExecutorName(req.assigned_to, executors);
                const city = req.parameters?.parameters?.city || '–ù–µ —É–∫–∞–∑–∞–Ω';
                const dataType = req.parameters?.parameters?.data_type || '–ù–µ —É–∫–∞–∑–∞–Ω';
                const createdDate = new Date(req.created_at).toLocaleString('ru-RU');
                
                requestsTable += '<tr>' +
                    '<td>#' + req.id + '</td>' +
                    '<td>' + statusText + '</td>' +
                    '<td>' + city + '</td>' +
                    '<td>' + dataType + '</td>' +
                    '<td>' + executorName + '</td>' +
                    '<td>' + createdDate + '</td>' +
                '</tr>';
            });
            
            return '<!DOCTYPE html>' +
                '<html lang="ru">' +
                '<head>' +
                    '<meta charset="UTF-8">' +
                    '<title>–û—Ç—á–µ—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫</title>' +
                '</head>' +
                '<body style="font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5;">' +
                    '<div style="max-width: 1200px; margin: 0 auto;">' +
                        '<div style="text-align: center; background: #3b82f6; color: white; padding: 30px; border-radius: 8px; margin-bottom: 30px;">' +
                            '<h1>üìä –û—Ç—á–µ—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫</h1>' +
                            '<p>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ' + currentDate + '</p>' +
                        '</div>' +
                        '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">' +
                            '<div style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">' +
                                '<div style="font-size: 2rem; font-weight: bold; color: #3b82f6; margin-bottom: 5px;">' + stats.total_requests + '</div>' +
                                '<div style="color: #666; font-size: 0.9rem;">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>' +
                            '</div>' +
                            '<div style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">' +
                                '<div style="font-size: 2rem; font-weight: bold; color: #3b82f6; margin-bottom: 5px;">' + stats.completed_requests + '</div>' +
                                '<div style="color: #666; font-size: 0.9rem;">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>' +
                            '</div>' +
                            '<div style="background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">' +
                                '<div style="font-size: 2rem; font-weight: bold; color: #3b82f6; margin-bottom: 5px;">' + stats.active_executors + '</div>' +
                                '<div style="color: #666; font-size: 0.9rem;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</div>' +
                            '</div>' +
                        '</div>' +
                        '<div style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 30px;">' +
                            '<h3 style="padding: 20px; margin: 0; background: #f8f9fa;">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∑–∞—è–≤–∫–∞–º</h3>' +
                            '<table style="width: 100%; border-collapse: collapse;">' +
                                '<thead>' +
                                    '<tr>' +
                                        '<th style="padding: 12px; text-align: left; border-bottom: 1px solid #eee; background: #f8f9fa; font-weight: 600; color: #333;">ID –∑–∞—è–≤–∫–∏</th>' +
                                        '<th style="padding: 12px; text-align: left; border-bottom: 1px solid #eee; background: #f8f9fa; font-weight: 600; color: #333;">–°—Ç–∞—Ç—É—Å</th>' +
                                        '<th style="padding: 12px; text-align: left; border-bottom: 1px solid #eee; background: #f8f9fa; font-weight: 600; color: #333;">–ì–æ—Ä–æ–¥</th>' +
                                        '<th style="padding: 12px; text-align: left; border-bottom: 1px solid #eee; background: #f8f9fa; font-weight: 600; color: #333;">–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</th>' +
                                        '<th style="padding: 12px; text-align: left; border-bottom: 1px solid #eee; background: #f8f9fa; font-weight: 600; color: #333;">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>' +
                                        '<th style="padding: 12px; text-align: left; border-bottom: 1px solid #eee; background: #f8f9fa; font-weight: 600; color: #333;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>' +
                                    '</tr>' +
                                '</thead>' +
                                '<tbody>' +
                                    requestsTable +
                                '</tbody>' +
                            '</table>' +
                        '</div>' +
                        '<div style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 40px; padding: 20px; border-top: 1px solid #eee;">' +
                            '<p>–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫</p>' +
                        '</div>' +
                    '</div>' +
                '</body>' +
                '</html>';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 12px 20px; border-radius: 8px; color: white; font-weight: 500; z-index: 10000; animation: slideIn 0.3s ease; max-width: 300px; word-wrap: break-word;';

            if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #10b981, #059669)';
            } else if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            } else {
                notification.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        function updateRequestStats() {
            const now = Date.now();
            const timeDiff = now - requestStats.lastMinuteTime;
            
            // –ï—Å–ª–∏ –ø—Ä–æ—à–ª–∞ –º–∏–Ω—É—Ç–∞, –≤—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (timeDiff >= 60000) { // 60 —Å–µ–∫—É–Ω–¥
                const requestsThisMinute = requestStats.totalProcessed - requestStats.lastMinuteProcessed;
                const totalTime = (now - requestStats.startTime) / 1000 / 60; // –≤ –º–∏–Ω—É—Ç–∞—Ö
                const avgRequestsPerMinute = Math.round(requestStats.totalProcessed / totalTime);
                
                console.log('üìä === –°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò –ó–ê–ü–†–û–°–û–í ===');
                console.log(`‚è±Ô∏è  –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${Math.round(totalTime)} –º–∏–Ω—É—Ç`);
                console.log(`üìà –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É: ${requestsThisMinute} –∑–∞—è–≤–æ–∫`);
                console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ: ${requestStats.totalProcessed} –∑–∞—è–≤–æ–∫`);
                console.log(`‚ö° –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${avgRequestsPerMinute} –∑–∞—è–≤–æ–∫/–º–∏–Ω`);
                console.log(`üéØ –¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${requestsThisMinute} –∑–∞—è–≤–æ–∫/–º–∏–Ω`);
                console.log(`üïê –í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}`);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const requestsPerSecond = Math.round(requestsThisMinute / 60 * 10) / 10;
                const efficiency = requestsThisMinute > 0 ? 'üü¢ –í—ã—Å–æ–∫–∞—è' : 'üü° –ù–∏–∑–∫–∞—è';
                console.log(`üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${requestsPerSecond} –∑–∞—è–≤–æ–∫/—Å–µ–∫`);
                console.log(`üìà –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${efficiency}`);
                console.log('==========================================');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –º–∏–Ω—É—Ç—ã
                requestStats.lastMinuteProcessed = requestStats.totalProcessed;
                requestStats.lastMinuteTime = now;
                requestStats.requestsPerMinute = requestsThisMinute;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
        function incrementProcessedRequests() {
            requestStats.totalProcessed++;
            updateRequestStats();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏)
        function getCurrentStats() {
            const now = Date.now();
            const totalTime = (now - requestStats.startTime) / 1000 / 60;
            const avgRequestsPerMinute = Math.round(requestStats.totalProcessed / totalTime);
            const requestsThisMinute = requestStats.totalProcessed - requestStats.lastMinuteProcessed;
            
            console.log('üìä === –¢–ï–ö–£–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===');
            console.log(`‚è±Ô∏è  –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${Math.round(totalTime)} –º–∏–Ω—É—Ç`);
            console.log(`üìà –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É: ${requestsThisMinute} –∑–∞—è–≤–æ–∫`);
            console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ: ${requestStats.totalProcessed} –∑–∞—è–≤–æ–∫`);
            console.log(`‚ö° –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${avgRequestsPerMinute} –∑–∞—è–≤–æ–∫/–º–∏–Ω`);
            console.log(`üéØ –¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${requestsThisMinute} –∑–∞—è–≤–æ–∫/–º–∏–Ω`);
            console.log('=============================');
            
            return {
                totalTime: Math.round(totalTime),
                requestsThisMinute,
                totalProcessed: requestStats.totalProcessed,
                avgRequestsPerMinute,
                currentSpeed: requestsThisMinute
            };
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–∞—Ç–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function getQuickStats() {
            const now = Date.now();
            const totalTime = (now - requestStats.startTime) / 1000 / 60;
            const requestsThisMinute = requestStats.totalProcessed - requestStats.lastMinuteProcessed;
            const avgRequestsPerMinute = Math.round(requestStats.totalProcessed / totalTime);
            
            console.log('‚ö° === –ë–´–°–¢–†–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===');
            console.log(`üìä –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${requestStats.totalProcessed} –∑–∞—è–≤–æ–∫`);
            console.log(`üìà –ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É: ${requestsThisMinute} –∑–∞—è–≤–æ–∫`);
            console.log(`‚ö° –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${avgRequestsPerMinute} –∑–∞—è–≤–æ–∫/–º–∏–Ω`);
            console.log(`üïê –í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}`);
            console.log('============================');
            
            return {
                totalProcessed: requestStats.totalProcessed,
                requestsThisMinute,
                avgRequestsPerMinute
            };
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
        window.getCurrentStats = getCurrentStats;
        window.getQuickStats = getQuickStats;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
            requestStats.startTime = Date.now();
            requestStats.lastMinuteTime = Date.now();
            requestStats.totalProcessed = 0;
            requestStats.lastMinuteProcessed = 0;
            
            console.log('üöÄ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—É—â–µ–Ω–∞!');
            console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –≤ –∫–æ–Ω—Å–æ–ª—å (F12)');
            
            loadStats();
            loadRecentRequests(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞—è–≤–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            
            // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞—è–≤–∫–∏ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã
            setTimeout(async () => {
                try {
                    const statsRes = await fetch(`${API_BASE}/stats`);
                    const stats = await statsRes.json();
                    
                    // –ï—Å–ª–∏ –∑–∞—è–≤–æ–∫ –º–∞–ª–æ, —Å–æ–∑–¥–∞–µ–º –º–Ω–æ–≥–æ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã
                    if (stats.pending_requests + stats.assigned_requests < 50) {
                        await createRandomRequests();
                        await createRandomRequests();
                        await createRandomRequests();
                        await createRandomRequests();
                        await createRandomRequests();
                    }
                } catch (error) {
                    console.log('[ERROR] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–∞—è–≤–æ–∫:', error);
                }
            }, 1000);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            const checkbox = document.getElementById('auto-refresh');
            if (checkbox) {
                checkbox.checked = true;
                toggleAutoRefresh();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫
            startBackgroundRequestCreation();
            
            
        });

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const stats = await response.json();
                
                updateStatValue('total-requests', stats.total_requests);
                updateStatValue('pending-requests', stats.pending_requests);
                updateStatValue('assigned-requests', stats.assigned_requests);
                updateStatValue('completed-requests', stats.completed_requests);
                updateStatValue('active-executors', stats.active_executors);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                const errorEl = document.getElementById('error-percent');
                const oldValue = parseFloat(errorEl.textContent) || 0;
                const newValue = stats.distribution_error_percent;
                
                if (oldValue !== newValue) {
                    errorEl.style.transition = 'all 0.3s';
                    errorEl.style.transform = 'scale(1.2)';
                    errorEl.style.color = newValue > 2 ? '#dc3545' : '#28a745';
                    
                    errorEl.textContent = newValue + '%';
                    
                    setTimeout(() => {
                        errorEl.style.transform = 'scale(1)';
                    }, 300);
                } else {
                    errorEl.textContent = newValue + '%';
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Å
                if (stats.distribution_error_percent > 2) {
                    errorEl.className = 'value error-percent';
                } else {
                    errorEl.className = 'value good-percent';
                }

                const cards = document.querySelectorAll('.stat-card');
                cards.forEach(card => {
                    card.style.transition = 'all 0.3s';
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        card.style.transform = 'scale(1)';
                    }, 50);
                });
                
                updateExecutorsList(stats.executor_stats);
                updateChart(stats.executor_stats);
                
               // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏
               updateProgressChart(stats);
               updatePerformanceAnalysisChart(stats.executor_stats);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—è–≤–∫–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                await loadRecentRequests();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            }
        }
        
        function updateStatValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.log(`[ERROR] –≠–ª–µ–º–µ–Ω—Ç ${elementId} –Ω–µ –Ω–∞–π–¥–µ–Ω!`);
                return;
            }
            
            const oldValue = parseInt(element.textContent) || 0;
            
            if (oldValue !== newValue) {
                element.style.transition = 'all 0.3s';
                element.style.transform = 'scale(1.2)';
                element.style.color = '#28a745';
                
                element.textContent = newValue;
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                    element.style.color = '';
                }, 300);
            } else {
                element.textContent = newValue;
            }
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é —Å—Å—ã–ª–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[onclick="scrollToSection('${sectionId}')"]`).classList.add('active');
            }
        }
        
        async function _removed_updateFlowDiagram() {
            try {
                const response = await fetch(`${API_BASE}/visual_data`);
                const data = await response.json();
                
                const pendingFlow = document.getElementById('pending-flow');
                pendingFlow.innerHTML = '';
                
                data.pending_requests.forEach(req => {
                    const box = document.createElement('div');
                    box.className = 'flow-box pending';
                    box.innerHTML = `<div style="font-size: 12px; font-weight: bold;">#${req.id}</div>`;
                    pendingFlow.appendChild(box);
                });
                
                if (data.pending_requests.length === 0) {
                    pendingFlow.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞—è–≤–æ–∫</p>';
                }
                
                const executorsFlow = document.getElementById('executors-flow');
                executorsFlow.innerHTML = '';
                
                data.executors.forEach(executor => {
                    const box = document.createElement('div');
                    box.className = 'flow-box executor';
                    box.innerHTML = `
                        <div style="font-size: 10px; margin-bottom: 5px;">${executor.name}</div>
                        <div style="font-size: 16px; font-weight: bold;">${executor.total_assigned}</div>
                    `;
                    
                    if (executor.assigned_requests.length > 0) {
                        const requestsContainer = document.createElement('div');
                        requestsContainer.style.display = 'flex';
                        requestsContainer.style.flexWrap = 'wrap';
                        requestsContainer.style.gap = '2px';
                        requestsContainer.style.maxWidth = '100px';
                        requestsContainer.style.justifyContent = 'center';
                        requestsContainer.style.marginTop = '5px';
                        
                        executor.assigned_requests.forEach(req => {
                            const reqBox = document.createElement('div');
                            reqBox.className = 'flow-request';
                            reqBox.textContent = '#' + req.id;
                            requestsContainer.appendChild(reqBox);
                        });
                        
                        box.appendChild(requestsContainer);
                    }
                    
                    executorsFlow.appendChild(box);
                });
                
                if (data.executors.length === 0) {
                    executorsFlow.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</p>';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã:', error);
            }
        }

        function updateExecutorsList(executors) {
            const list = document.getElementById('executors-list');
            const panel = document.getElementById('executors-panel');
            
            if (executors.length === 0) {
                if (list.innerHTML.indexOf('–ù–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π') === -1) {
                    list.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</p>';
                }
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –¥–ª—è –ø—É—Å—Ç–æ–π –ø–∞–Ω–µ–ª–∏
                if (panel) {
                    panel.style.minHeight = '200px';
                }
                return;
            }
            
            const currentHTML = list.innerHTML;
            let newHTML = '';
            
            executors.forEach(executor => {
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                let paramsText = '';
                if (executor.parameters) {
                    const params = [];
                    if (executor.parameters.city) {
                        params.push(`–ì–æ—Ä–æ–¥: ${executor.parameters.city}`);
                    }
                    if (executor.parameters.data_type) {
                        const dataTypeNames = {
                            'raster': '–†–∞—Å—Ç—Ä–æ–≤—ã–µ',
                            'numeric': '–ß–∏—Å–ª–æ–≤—ã–µ', 
                            'text': '–¢–µ–∫—Å—Ç–æ–≤—ã–µ'
                        };
                        params.push(`–¢–∏–ø: ${dataTypeNames[executor.parameters.data_type] || executor.parameters.data_type}`);
                    }
                    if (params.length > 0) {
                        paramsText = `<div style="color: #1e40af; font-size: 0.85em; margin-top: 4px;">
                            ${params.join(' | ')}
                        </div>`;
                    }
                }
                
                newHTML += `
                    <div class="executor-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${executor.name}</strong>
                            </div>
                            <button onclick="deleteExecutor(${executor.id})" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                        <div style="margin-top: 10px; color: #666;">
                            –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong>${executor.actual_count}</strong> –∑–∞—è–≤–æ–∫
                        </div>
                        ${paramsText}
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(executor.actual_count * 2, 100)}%;"></div>
                        </div>
                    </div>
                `;
            });
            
            if (currentHTML !== newHTML) {
                list.innerHTML = newHTML;
                
                // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ –∏–∑–º–µ–Ω—è–µ–º –≤—ã—Å–æ—Ç—É –ø–∞–Ω–µ–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
                if (panel) {
                    const itemHeight = 100; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
                    const minHeight = 200;
                    const calculatedHeight = Math.max(minHeight, executors.length * itemHeight + 100);
                    panel.style.minHeight = `${calculatedHeight}px`;
                }
                
                list.querySelectorAll('.executor-item').forEach((item, index) => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateX(-20px)';
                    setTimeout(() => {
                        item.style.transition = 'all 0.5s';
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    }, index * 50);
                });
            }
        }

        function updateChart(executorStats) {
            const chartContainer = document.getElementById('chart-container');
            
            if (!executorStats || executorStats.length === 0) {
                chartContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
                return;
            }
            
            const maxCount = Math.max(...executorStats.map(e => e.actual_count || 0));
            
            if (maxCount === 0) {
                chartContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫</p>';
                return;
            }
            
            let chartHTML = '';
            executorStats.forEach((executor, index) => {
                const height = (executor.actual_count / maxCount) * 100;
                const colors = [
                    'linear-gradient(180deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(180deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(180deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(180deg, #fa709a 0%, #fee140 100%)',
                    'linear-gradient(180deg, #30cfd0 0%, #330867 100%)',
                    'linear-gradient(180deg, #a8edea 0%, #fed6e3 100%)',
                    'linear-gradient(180deg, #ff9a9e 0%, #fecfef 100%)'
                ];
                const color = colors[index % colors.length];
                
                chartHTML += `
                    <div class="chart-bar">
                        <div class="chart-bar-value">${executor.actual_count}</div>
                        <div class="chart-bar-column" style="height: ${height}%; background: ${color};"></div>
                        <div class="chart-bar-label">${executor.name}</div>
                    </div>
                `;
            });
            
            chartContainer.innerHTML = chartHTML;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        function updateProgressChart(stats) {
            const progressChart = document.getElementById('progress-chart');
            
            if (!stats) {
                progressChart.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }

            const total = stats.total_requests || 0;
            const completed = stats.completed_requests || 0;
            const assigned = stats.assigned_requests || 0;
            const pending = stats.pending_requests || 0;
            
            if (total === 0) {
                progressChart.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>';
                return;
            }

            const completionRate = Math.round((completed / total) * 100);
            const processingRate = Math.round(((completed + assigned) / total) * 100);
            const pendingRate = Math.round((pending / total) * 100);

            // –°–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–æ–≤—É—é –¥–∏–∞–≥—Ä–∞–º–º—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const radius = 22;
            const circumference = 2 * Math.PI * radius;
            const completedOffset = circumference - (completionRate / 100) * circumference;
            const processingOffset = circumference - (processingRate / 100) * circumference;

            progressChart.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 8px; width: 100%;">
                    <div style="position: relative; width: 55px; height: 55px;">
                        <svg width="55" height="55" style="transform: rotate(-90deg);">
                            <!-- –§–æ–Ω–æ–≤–∞—è –æ–∫—Ä—É–∂–Ω–æ—Å—Ç—å -->
                            <circle cx="27.5" cy="27.5" r="${radius}" stroke="#e5e7eb" stroke-width="3" fill="none"/>
                            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
                            <circle cx="27.5" cy="27.5" r="${radius}" stroke="#3b82f6" stroke-width="3" fill="none" 
                                    stroke-dasharray="${circumference}" stroke-dashoffset="${processingOffset}" 
                                    stroke-linecap="round" style="transition: stroke-dashoffset 0.5s ease;"/>
                            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
                            <circle cx="27.5" cy="27.5" r="${radius}" stroke="#10b981" stroke-width="3" fill="none" 
                                    stroke-dasharray="${circumference}" stroke-dashoffset="${completedOffset}" 
                                    stroke-linecap="round" style="transition: stroke-dashoffset 0.5s ease;"/>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                            <div style="font-size: 12px; font-weight: 700; color: #10b981;">${completionRate}%</div>
                            <div style="font-size: 7px; color: #6b7280;">–∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(16, 185, 129, 0.1); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
                                <span style="font-size: 12px; color: #374151;">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                            </div>
                            <span style="font-weight: 600; color: #10b981; font-size: 12px;">${completed}</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(59, 130, 246, 0.1); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;"></div>
                                <span style="font-size: 12px; color: #374151;">–í —Ä–∞–±–æ—Ç–µ</span>
                            </div>
                            <span style="font-weight: 600; color: #3b82f6; font-size: 12px;">${assigned}</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(245, 158, 11, 0.1); border-radius: 6px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
                                <span style="font-size: 12px; color: #374151;">–û–∂–∏–¥–∞—é—Ç</span>
                            </div>
                            <span style="font-weight: 600; color: #f59e0b; font-size: 12px;">${pending}</span>
                        </div>
                    </div>
                </div>
            `;
        }


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function updatePerformanceAnalysisChart(executorStats) {
            const performanceAnalysisChart = document.getElementById('performance-analysis-chart');
            
            if (!executorStats || executorStats.length === 0) {
                performanceAnalysisChart.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
            const totalWork = executorStats.reduce((sum, e) => sum + (e.actual_count || 0), 0);
            const avgWork = totalWork / executorStats.length;
            
            const performanceData = executorStats.map(executor => {
                const work = executor.actual_count || 0;
                const efficiency = avgWork > 0 ? Math.round((work / avgWork) * 100) : 0;
                const status = efficiency >= 120 ? 'excellent' : efficiency >= 80 ? 'good' : efficiency >= 50 ? 'average' : 'poor';
                
                return {
                    name: executor.name,
                    work: work,
                    efficiency: efficiency,
                    status: status
                };
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            performanceData.sort((a, b) => b.efficiency - a.efficiency);

            const getStatusColor = (status) => {
                switch (status) {
                    case 'excellent': return '#10b981';
                    case 'good': return '#3b82f6';
                    case 'average': return '#f59e0b';
                    case 'poor': return '#ef4444';
                    default: return '#6b7280';
                }
            };

            const getStatusIcon = (status) => {
                switch (status) {
                    case 'excellent': return 'üöÄ';
                    case 'good': return 'üëç';
                    case 'average': return '‚ö°';
                    case 'poor': return 'üìâ';
                    default: return '‚ùì';
                }
            };

            const getStatusText = (status) => {
                switch (status) {
                    case 'excellent': return '–û—Ç–ª–∏—á–Ω–æ';
                    case 'good': return '–•–æ—Ä–æ—à–æ';
                    case 'average': return '–°—Ä–µ–¥–Ω–µ';
                    case 'poor': return '–ù–∏–∑–∫–æ';
                    default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                }
            };

            performanceAnalysisChart.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 3px; width: 100%;">
                    ${performanceData.slice(0, 3).map(executor => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px; background: rgba(139, 92, 246, 0.05); border-radius: 3px; border-left: 2px solid ${getStatusColor(executor.status)};">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <span style="font-size: 10px;">${getStatusIcon(executor.status)}</span>
                                <div>
                                    <div style="font-weight: 600; color: #2d3748; font-size: 9px;">${executor.name}</div>
                                    <div style="color: #6b7280; font-size: 7px;">${executor.work} –∑–∞—è–≤–æ–∫</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 10px; font-weight: 700; color: ${getStatusColor(executor.status)};">${executor.efficiency}%</div>
                                <div style="font-size: 7px; color: #6b7280;">${getStatusText(executor.status)}</div>
                            </div>
                        </div>
                    `).join('')}
                    
                    <div style="margin-top: 4px; padding: 6px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 3px; color: white; text-align: center;">
                        <div style="font-size: 8px; font-weight: 600; margin-bottom: 1px;">–°—Ä–µ–¥–Ω—è—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                        <div style="font-size: 12px; font-weight: 700;">${Math.round(performanceData.reduce((sum, e) => sum + e.efficiency, 0) / performanceData.length)}%</div>
                    </div>
                </div>
            `;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
        function animateRequestMovement(requestId, newStatus) {
            const list = document.getElementById('requests-list');
            if (!list) {
                console.warn('–≠–ª–µ–º–µ–Ω—Ç requests-list –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            const requestItems = list.querySelectorAll('.request-item');
            
            // –ò—â–µ–º –∑–∞—è–≤–∫—É –ø–æ ID
            let foundItem = null;
            requestItems.forEach(item => {
                const strongElement = item.querySelector('strong');
                if (strongElement && strongElement.textContent) {
                    const itemId = strongElement.textContent.match(/#(\d+)/);
                    if (itemId && parseInt(itemId[1]) === requestId) {
                        foundItem = item;
                    }
                }
            });
            
            if (!foundItem) {
                // –ù–µ –≤—ã–≤–æ–¥–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –∑–∞—è–≤–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ —Å–ø–∏—Å–æ–∫
                return;
            }
            
            if (foundItem) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏
                foundItem.classList.add('moving');
                
                // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è
                const approvalIndicator = document.createElement('div');
                approvalIndicator.style.cssText = `
                    position: absolute;
                    top: 5px;
                    right: 10px;
                    background: rgba(0,0,0,0.1);
                    padding: 2px 8px;
                    border-radius: 10px;
                    font-size: 0.7em;
                    color: #666;
                    z-index: 10;
                `;
                approvalIndicator.textContent = '–û–¥–æ–±—Ä–µ–Ω–∏–µ...';
                foundItem.style.position = 'relative';
                foundItem.appendChild(approvalIndicator);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ—ç—Ç–∞–ø–Ω–æ
                const statusText = {
                    'pending': '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
                    'assigned': 'üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∞',
                    'completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞'
                };
                
                const statusDiv = foundItem.querySelector('div');
                if (statusDiv) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–¥–æ–±—Ä–µ–Ω–∏—è
                    const approvalSteps = [
                        'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö...',
                        'üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è...',
                        '‚ö° –û–±—Ä–∞–±–æ—Ç–∫–∞...',
                        '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ!'
                    ];
                    
                    let stepIndex = 0;
                    const stepInterval = setInterval(() => {
                        if (stepIndex < approvalSteps.length) {
                            statusDiv.innerHTML = `–°—Ç–∞—Ç—É—Å: ${approvalSteps[stepIndex]}`;
                            stepIndex++;
                        } else {
                            clearInterval(stepInterval);
                            statusDiv.innerHTML = `–°—Ç–∞—Ç—É—Å: ${statusText[newStatus]}`;
                        }
                    }, 15);
                }
                
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    if (foundItem.parentNode) {
                        foundItem.parentNode.removeChild(foundItem);
                    }
                }, 300); // 0.3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è
            } else {
                // –ï—Å–ª–∏ –∑–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ, –∞–Ω–∏–º–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É
                if (requestItems.length > 0) {
                    const firstItem = requestItems[0];
                    console.log(`–ó–∞—è–≤–∫–∞ #${requestId} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–¥–æ–±—Ä–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–≤–æ–π –∑–∞—è–≤–∫–∏`);
                    
                    firstItem.classList.add('moving');
                    firstItem.style.position = 'relative';
                    
                    const approvalIndicator = document.createElement('div');
                    approvalIndicator.style.cssText = `
                        position: absolute;
                        top: 5px;
                        right: 10px;
                        background: rgba(0,0,0,0.1);
                        padding: 2px 8px;
                        border-radius: 10px;
                        font-size: 0.7em;
                        color: #666;
                        z-index: 10;
                    `;
                    approvalIndicator.textContent = '–û–¥–æ–±—Ä–µ–Ω–∏–µ...';
                    firstItem.appendChild(approvalIndicator);
                    
                    const statusText = {
                        'pending': '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
                        'assigned': 'üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∞',
                        'completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞'
                    };
                    
                    const statusDiv = firstItem.querySelector('div');
                    if (statusDiv) {
                        const approvalSteps = [
                            'üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö...',
                            'üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è...',
                            '‚ö° –û–±—Ä–∞–±–æ—Ç–∫–∞...',
                            '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ!'
                        ];
                        
                        let stepIndex = 0;
                        const stepInterval = setInterval(() => {
                            if (stepIndex < approvalSteps.length) {
                                statusDiv.innerHTML = `–°—Ç–∞—Ç—É—Å: ${approvalSteps[stepIndex]}`;
                                stepIndex++;
                            } else {
                                clearInterval(stepInterval);
                                statusDiv.innerHTML = `–°—Ç–∞—Ç—É—Å: ${statusText[newStatus]}`;
                            }
                        }, 15);
                    }
                    
                    setTimeout(() => {
                        if (firstItem.parentNode) {
                            firstItem.parentNode.removeChild(firstItem);
                        }
                    }, 300);
                }
            }
        }


        async function loadRecentRequests() {
            try {
                const response = await fetch(`${API_BASE}/requests/recent/30`);
                const requests = await response.json();
                
                const list = document.getElementById('requests-list');
                
                if (requests.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>';
                    stopCyclicAnimation();
                    return;
                }
                
                let newHTML = '';
                requests.forEach(request => {
                    const statusText = {
                        'pending': '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
                        'assigned': 'üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∞',
                        'completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞'
                    };
                    
                    const executorName = request.assigned_to ? ` ‚Üí –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ${request.assigned_to}` : '';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    let paramsText = '';
                    if (request.parameters) {
                        const params = [];
                        if (request.parameters.city) {
                            params.push(`–ì–æ—Ä–æ–¥: ${request.parameters.city}`);
                        }
                        if (request.parameters.data_type) {
                            const dataTypeNames = {
                                'raster': '–†–∞—Å—Ç—Ä–æ–≤—ã–µ',
                                'numeric': '–ß–∏—Å–ª–æ–≤—ã–µ', 
                                'text': '–¢–µ–∫—Å—Ç–æ–≤—ã–µ'
                            };
                            params.push(`–¢–∏–ø: ${dataTypeNames[request.parameters.data_type] || request.parameters.data_type}`);
                        }
                        if (request.type) {
                            params.push(`–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${request.type}`);
                        }
                        if (request.customer_id) {
                            params.push(`–ö–ª–∏–µ–Ω—Ç: ${request.customer_id}`);
                        }
                        if (request.value) {
                            params.push(`–°—É–º–º–∞: ${request.value}`);
                        }
                        paramsText = params.join(' | ');
                    }
                    
                    newHTML += `
                        <div class="request-item ${request.status}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>#${request.id}</strong>
                                <span style="font-size: 0.8em; color: #666;">${statusText[request.status]}</span>
                            </div>
                            <div style="font-size: 0.8em; color: #999; margin-top: 3px;">
                                ${paramsText || JSON.stringify(request.parameters || {}).substring(0, 40) + '...'}
                            </div>
                        </div>
                    `;
                });
                
                list.innerHTML = newHTML;
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª–∏—á–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é
                startCyclicAnimation();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:', error);
            }
        }
        
        let animationInterval = null;
        
        function startCyclicAnimation() {
            const list = document.getElementById('requests-list');
            
            function animateItems() {
                const items = list.querySelectorAll('.request-item');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞—è–≤–∫–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                if (items.length === 0) {
                    console.log('[DEBUG] –ù–µ—Ç –∑–∞—è–≤–æ–∫ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏');
                    return;
                }
                
                // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∑–∞—è–≤–∫–∏
                items.forEach((item) => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateY(-20px)';
                });
                
                // –ó–∞—Ç–µ–º –∞–Ω–∏–º–∏—Ä—É–µ–º —Å –≤–æ–ª–Ω–æ–≤—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º, –Ω–æ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏
                setTimeout(() => {
                    items.forEach((item, index) => {
                        setTimeout(() => {
                            item.style.transition = 'all 0.4s ease';
                            item.style.opacity = '1';
                            item.style.transform = 'translateY(0)';
                        }, index * 20); // –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 20ms –º–µ–∂–¥—É –∑–∞—è–≤–∫–∞–º–∏
                    });
                }, 50); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∞–Ω–∏–º–∞—Ü–∏–∏
            }
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∞–Ω–∏–º–∞—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
            if (animationInterval) {
                clearInterval(animationInterval);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—Ä–∞–∑—É
            animateItems();
            
            // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è 30 –∑–∞—è–≤–æ–∫)
            animationInterval = setInterval(animateItems, 1500);
        }
        
        function stopCyclicAnimation() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫ –≤ —Ñ–æ–Ω–µ
        function startBackgroundRequestCreation() {
            setInterval(async () => {
                try {
                    const statsRes = await fetch(`${API_BASE}/stats`);
                    const stats = await statsRes.json();
                    
                    // –ï—Å–ª–∏ –∑–∞—è–≤–æ–∫ –º–µ–Ω—å—à–µ 30, —Å–æ–∑–¥–∞–µ–º –µ—â–µ
                    if (stats.pending_requests + stats.assigned_requests < 30) {
                        await createRandomRequests();
                    }
                } catch (error) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
                }
            }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –ø—Ä–æ–≤–µ—Ä—è–µ–º
        }

        function showExecutorModal() {
            const modal = document.getElementById('executor-modal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        function closeExecutorModal() {
            const modal = document.getElementById('executor-modal');
            modal.style.display = 'none';
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('executor-name').value = '';
            document.getElementById('executor-city').value = '';
            document.getElementById('executor-data-type').value = '';
        }
        
        async function createExecutorFromModal() {
            const name = document.getElementById('executor-name').value.trim();
            const city = document.getElementById('executor-city').value;
            const dataType = document.getElementById('executor-data-type').value;
            
            
            if (!name) {
                console.log('[ERROR] –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è!');
                return;
            }
            
            try {
                const executorData = { name };
                if (city) {
                    executorData.city = city;
                }
                if (dataType) {
                    executorData.data_type = dataType;
                }
                
                const response = await fetch(`${API_BASE}/executors/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(executorData)
                });
                
                if (response.ok) {
                    closeExecutorModal();
                    loadStats();
                    console.log('[INFO] –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω!');
                } else {
                    const errorText = await response.text();
                    console.log('[ERROR] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:', response.status, errorText);
                }
            } catch (error) {
                console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        function createExecutor() {
            showExecutorModal();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
        function toggleCreateDropdown() {
            const dropdown = document.getElementById('create-dropdown');
            dropdown.classList.toggle('show');
        }

        function hideCreateDropdown() {
            const dropdown = document.getElementById('create-dropdown');
            dropdown.classList.remove('show');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
        let executorToDelete = null;

        function showDeleteModal(executorId, executorName) {
            executorToDelete = executorId;
            document.getElementById('delete-executor-name').textContent = executorName;
            document.getElementById('delete-modal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').style.display = 'none';
            executorToDelete = null;
        }

        async function confirmDeleteExecutor() {
            if (!executorToDelete) return;

            try {
                const response = await fetch(`${API_BASE}/executors/${executorToDelete}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    console.log('[INFO] –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω!');
                    closeDeleteModal();
                    loadStats(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                } else {
                    const errorText = await response.text();
                    console.log('[ERROR] –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:', response.status, errorText);
                }
            } catch (error) {
                console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function deleteExecutor(executorId) {
            // –ù–∞—Ö–æ–¥–∏–º –∏–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            const executorItems = document.querySelectorAll('.executor-item');
            let executorName = '–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è';
            
            for (let item of executorItems) {
                const button = item.querySelector(`button[onclick*="${executorId}"]`);
                if (button) {
                    const nameElement = item.querySelector('strong');
                    if (nameElement) {
                        executorName = nameElement.textContent;
                    }
                    break;
                }
            }
            
            showDeleteModal(executorId, executorName);
        }

        async function createRandomRequests() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statsRes = await fetch(`${API_BASE}/stats`);
                const stats = await statsRes.json();
                
                // –°–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫–∏ –µ—Å–ª–∏ –∏—Ö –º–µ–Ω—å—à–µ 100 (–µ—â–µ –±–æ–ª—å—à–µ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
                if (stats.pending_requests + stats.assigned_requests >= 100) {
                    return;
                }
                
                const requests = [];
                const types = ['urgent', 'normal', 'low'];
                const cities = ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', '–ö–∞–∑–∞–Ω—å'];
                const dataTypes = ['raster', 'numeric', 'text'];
                
                // –°–æ–∑–¥–∞–µ–º 5-12 –∑–∞—è–≤–æ–∫ –∑–∞ —Ä–∞–∑ (–µ—â–µ –±–æ–ª—å—à–µ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
                const requestsToCreate = Math.floor(Math.random() * 8) + 5;
                
                for (let i = 0; i < requestsToCreate; i++) {
                    requests.push({
                        type: types[Math.floor(Math.random() * types.length)],
                        customer_id: Math.floor(Math.random() * 9000) + 1000,
                        value: Math.floor(Math.random() * 50000) + 100,
                        parameters: {
                            city: cities[Math.floor(Math.random() * cities.length)],
                            data_type: dataTypes[Math.floor(Math.random() * dataTypes.length)]
                        }
                    });
                }
                
                const response = await fetch(`${API_BASE}/requests/bulk/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({requests})
                });
                
                if (response.ok) {
                    console.log(`[INFO] –°–æ–∑–¥–∞–Ω–æ ${requestsToCreate} –∑–∞—è–≤–æ–∫!`);
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞—è–≤–∫–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => {
                        loadRecentRequests();
                    }, 100);
                } else {
                    console.log('[ERROR] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫:', response.status);
                }
            } catch (error) {
                console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

async function createMassiveRequests() {
    try {
        const requests = [];
        const types = ['urgent', 'normal', 'low'];
        
        for (let i = 0; i < 1000; i++) {
            requests.push({
                type: types[Math.floor(Math.random() * types.length)],
                customer_id: Math.floor(Math.random() * 9000) + 1000,
                value: Math.floor(Math.random() * 50000) + 100
            });
        }
        
        const response = await fetch(`${API_BASE}/requests/bulk/`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({requests})
        });
        
        if (response.ok) {
            loadStats();
            console.log('[INFO] –°–æ–∑–¥–∞–Ω–æ 1000 –∑–∞—è–≤–æ–∫!');
        } else {
            console.log('[ERROR] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫');
        }
    } catch (error) {
        console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.message);
    }
}

async function createContinuousRequests() {
    try {
        const requests = [];
        const types = ['urgent', 'normal', 'low'];
        
        for (let i = 0; i < 10000; i++) {
            requests.push({
                type: types[Math.floor(Math.random() * types.length)],
                customer_id: Math.floor(Math.random() * 9000) + 1000,
                value: Math.floor(Math.random() * 50000) + 100
            });
        }
        
        const response = await fetch(`${API_BASE}/requests/bulk/`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({requests})
        });
        
        if (response.ok) {
            loadStats();
            console.log('[INFO] –°–æ–∑–¥–∞–Ω–æ 10000 –∑–∞—è–≤–æ–∫!');
        } else {
            console.log('[ERROR] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫');
        }
    } catch (error) {
        console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.message);
    }
}

async function clearAllRequests() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞—è–≤–∫–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE}/requests/clear`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            loadStats();
            console.log('[INFO] –í—Å–µ –∑–∞—è–≤–∫–∏ —É–¥–∞–ª–µ–Ω—ã!');
        } else {
            console.log('[ERROR] –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫');
        }
    } catch (error) {
        console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.message);
    }
}

        async function distributeRequests() {
            try {
                const executorsRes = await fetch(`${API_BASE}/executors/`);
                const executors = await executorsRes.json();
                
                if (executors.length === 0) {
                    return;
                }
                
                const activeExecutors = executors.filter(e => e.is_active);
                // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ 5 –∑–∞—è–≤–æ–∫ –Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∑–∞ —Ü–∏–∫–ª (–±–æ–ª—å—à–µ –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
                for (let i = 0; i < 5; i++) {
                    for (const executor of activeExecutors) {
                        try {
                            const response = await fetch(`${API_BASE}/executors/${executor.id}/get-next-request`, {
                                method: 'POST'
                            });
                            
                            // –ï—Å–ª–∏ –∑–∞—è–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞, —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–µ–º –µ—ë –¥–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
                            if (response.ok) {
                                const requestData = await response.json();
                                if (requestData) {
                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–≤–∏–∂–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ –∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é
                                    animateRequestMovement(requestData.id, 'assigned');
                                    
                                    // –ó–∞–≤–µ—Ä—à–∞–µ–º –∑–∞—è–≤–∫—É —á–µ—Ä–µ–∑ 200ms –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
                                    setTimeout(async () => {
                                        try {
                                            await fetch(`${API_BASE}/requests/${requestData.id}/complete`, {
                                                method: 'POST',
                                                headers: {'Content-Type': 'application/json'},
                                                body: JSON.stringify({result: `Completed by ${executor.name}`})
                                            });
                                            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
                                            incrementProcessedRequests();
                                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞—è–≤–∫–∏
                                            setTimeout(() => {
                                                animateRequestMovement(requestData.id, 'completed');
                                            }, 50);
                                        } catch (e) {
                                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                                        }
                                    }, 50);
                                }
                            }
                        } catch (e) {
                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
                        }
                    }
                }
                
            } catch (error) {
                console.log('[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏: ' + error.message);
            }
        }

        async function completeRandomRequests() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const statsRes = await fetch(`${API_BASE}/stats`);
                const stats = await statsRes.json();
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏, –∑–∞–≤–µ—Ä—à–∞–µ–º —Ç–æ–ª—å–∫–æ 1-2 —Å–ª—É—á–∞–π–Ω—ã—Ö (–µ—â–µ –º–µ–Ω—å—à–µ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã)
                if (stats.assigned_requests > 0) {
                    const numToComplete = Math.min(Math.floor(Math.random() * 2) + 1, stats.assigned_requests);
                    
                    for (let i = 0; i < numToComplete; i++) {
                        try {
                            // –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –∑–∞—è–≤–∫—É
                            const requestsRes = await fetch(`${API_BASE}/requests/recent/100`);
                            const requests = await requestsRes.json();
                            const assignedRequests = requests.filter(r => r.status === 'assigned');
                            
                            if (assignedRequests.length > 0) {
                                const randomRequest = assignedRequests[Math.floor(Math.random() * assignedRequests.length)];
                                await fetch(`${API_BASE}/requests/${randomRequest.id}/complete`, {
                                    method: 'POST'
                                });
                                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫
                                incrementProcessedRequests();
                            }
                        } catch (e) {
                            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                        }
                    }
                }
            } catch (error) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
            }
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh');
            if (checkbox.checked) {
                autoRefreshInterval = setInterval(async () => {
                    try {
                        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        const statsRes = await fetch(`${API_BASE}/stats`);
                        const stats = await statsRes.json();
                        
                        // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∏—Ö
                        if (stats.pending_requests > 0) {
                            await distributeRequests();
                        }
                        
                        // –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞—è–≤–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                        await completeRandomRequests();
                        
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –µ—â–µ —á–∞—â–µ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã
                        if (stats.pending_requests + stats.assigned_requests < 100 && Math.random() < 0.9) { // 90% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
                            await createRandomRequests();
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        await loadStats();
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é
                        if (stats.pending_requests + stats.assigned_requests === 0) {
                            stopCyclicAnimation();
                        }
                        
                        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫–∏ –µ—Å–ª–∏ –∏—Ö —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ
                        if (stats.pending_requests + stats.assigned_requests < 20) {
                            await createRandomRequests();
                            await createRandomRequests();
                        }
                        
                    } catch (error) {
                        console.log('[ERROR] –û—à–∏–±–∫–∞ –≤ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: ' + error.message);
                    }
                }, 200);
                console.log('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ');
            } else {
                clearInterval(autoRefreshInterval);
                console.log('–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ');
            }
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.match(/\.(xlsx|xls)$/)) {
                console.log('[WARN] –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx –∏–ª–∏ .xls)');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                const response = await fetch(`${API_BASE}/upload/excel`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('[INFO] ' + result.message);
                    loadStats();
                } else {
                    const error = await response.json();
                    console.log('[ERROR] –û—à–∏–±–∫–∞: ' + error.detail);
                }
            } catch (error) {
                console.log('[ERROR] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
            }
            
            event.target.value = '';
        }

        loadStats();

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const executorModal = document.getElementById('executor-modal');
            const deleteModal = document.getElementById('delete-modal');
            const createDropdown = document.getElementById('create-dropdown');
            
            if (event.target === executorModal) {
                closeExecutorModal();
            }
            
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            if (!event.target.matches('.dropdown-toggle') && !event.target.closest('.dropdown')) {
                hideCreateDropdown();
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const executorModal = document.getElementById('executor-modal');
                const deleteModal = document.getElementById('delete-modal');
                const createDropdown = document.getElementById('create-dropdown');
                
                if (executorModal.style.display === 'flex') {
                    closeExecutorModal();
                }
                
                if (deleteModal.style.display === 'flex') {
                    closeDeleteModal();
                }
                
                if (createDropdown.classList.contains('show')) {
                    hideCreateDropdown();
                }
            }
        });
    </script>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è -->
    <div id="executor-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeExecutorModal()">&times;</span>
            <h3>–î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</h3>
            
            <div class="form-group">
                <label for="executor-name">–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:</label>
                <input type="text" id="executor-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Executor-1" required>
            </div>
            
            <div class="form-group">
                <label for="executor-city">–ì–æ—Ä–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <select id="executor-city">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                    <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
                    <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                    <option value="–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                    <option value="–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
                    <option value="–ö–∞–∑–∞–Ω—å">–ö–∞–∑–∞–Ω—å</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="executor-data-type">–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <select id="executor-data-type">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö</option>
                    <option value="raster">–†–∞—Å—Ç—Ä–æ–≤—ã–µ</option>
                    <option value="numeric">–ß–∏—Å–ª–æ–≤—ã–µ</option>
                    <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–µ</option>
                </select>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="createExecutorFromModal()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="btn btn-warning" onclick="closeExecutorModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeDeleteModal()">&times;</span>
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
            
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3em; color: #dc3545; margin-bottom: 10px;">‚ö†Ô∏è</div>
                    <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è <strong id="delete-executor-name"></strong>?</p>
                </div>
                <p class="warning-block">
                    –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥—Ä—É–≥–∏–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º.
                </p>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-danger" onclick="confirmDeleteExecutor()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn btn-warning" onclick="closeDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
</body>
</html>

